<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title> Chat Application </title>
		
		<!-- Bootstrap core CSS -->
		<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.5/sandstone/bootstrap.min.css" rel="stylesheet">

		<style>
			#message_form {
				bottom: 0;
				position: fixed;
			}
		</style>

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>

	<body>
		<div class="container">
			<div class="well">
				<h3> Users Connected </h3>
				<div id="users"></div>
			</div>
			<table class="table table-hover">
				<thead>
					<tr>
						<th class="col-lg-2 col-md-2 col-sm-2"> Name </th>
						<th class="col-lg-8 col-md-8 col-sm-8"> Message </th>
						<th class="col-lg-2 col-md-2 col-sm-2"></th>
					</tr>
				</thead>
				<tbody id="messages"></tbody>
			</table>
		</div>

		<form id="message_form">
			<div class="input-group">
      			<input type="text" class="form-control" id="message_button" autocomplete="off"/>
      			<span class="input-group-btn">
      				<button type="submit" class="btn btn-primary"> Send </button>
      			</span>
      		</div>
		</form>

		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" crossorigin="anonymous"></script>

		<!-- Include javascript for server connection -->
		<script src="/socket.io/socket.io.js"></script>
		<script>
			var person = prompt("Please enter your name");		
			var socket = io();

			socket.emit('connection name', {user_name: person});

			// send the data to the server to broadcast to everyone
			$('form').submit(function(e){
				e.preventDefault();
				socket.emit('chat message', {user_name: person, user_msg: $('#message_button').val()});
				$('#message_button').val('');
				return false;
			});

			// display different colors for each up to 6 users
			socket.on('chat message', function(data) {
				// grab the time
				var time = new Date();
				var hours = time.getHours();
				var minutes = time.getMinutes();
				var time_string = "";

				// convert the 24 hour clock to 12 hour
				if (hours > 12) {
					hours -= 12;
					time_string = hours + ":" + minutes + " pm";
				}
				else if(hours == 0)
				{
					hours = 12;
					time_string = hours + ":" + minutes + " am";
				}
				else
					time_string = hours + ":" + minutes + " am";

				// assign different colors to different users
				if((data.user_id % 6) == 0)
					$('#messages').append('<tr><td> ' + data.user_name + ' </td><td>' + data.user_msg + '</td><td> ' + time_string + ' </td></tr>');
				else if((data.user_id % 6) == 1)
					$('#messages').append('<tr class="active"><td> ' + data.user_name + ' </td><td>' + data.user_msg + '</td><td> ' + time_string + ' </td></tr>');
				else if((data.user_id % 6) == 2)
					$('#messages').append('<tr class="warning"><td> ' + data.user_name + ' </td><td>' + data.user_msg + '</td><td> ' + time_string + ' </td></tr>');
				else if((data.user_id % 6) == 3)
					$('#messages').append('<tr class="info"><td> ' + data.user_name + ' </td><td>' + data.user_msg + '</td><td> ' + time_string + ' </td></tr>');
				else if((data.user_id % 6) == 4)
					$('#messages').append('<tr class="danger"><td> ' + data.user_name + ' </td><td>' + data.user_msg + '</td><td> ' + time_string + ' </td></tr>');
				else if((data.user_id % 6) == 5)
					$('#messages').append('<tr class="success"><td> ' + data.user_name + ' </td><td>' + data.user_msg + '</td><td> ' + time_string + ' </td></tr>');

				// scroll to bottom of page
				$("html, body").animate({ scrollTop: $(document).height() }, "slow");
			});

			// updates the users connected list at the top
			socket.on('users update', function(users) {
				var temp = "";
				for(i = 0; i < users.length; i++)
					temp += "<p> " + users[i] + " </p>";
				$('#users').html(temp);
			});
		</script>
	</body>
</html>